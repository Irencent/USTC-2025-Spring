age <- ifelse(
format(date_dis_pos, "%m-%d") >= format(date_bir, "%m-%d"),
as.numeric(format(date_dis_pos, "%Y")) - as.numeric(format(date_bir, "%Y")),
as.numeric(format(date_dis_pos, "%Y")) - as.numeric(format(date_bir, "%Y")) - 1
)
age
sink("test.txt")
cat("å‘ç—…å¹´é¾„:", age, "å‘¨å²\n")
sink()
date_dis_monyy <- format(date_dis_pos, "%b%y")
date_dis_monyy
recheck_dates <- seq(
from = as.Date(date_dis_pos),
by = "7 days",
length.out = 10
)
recheck_dates <- seq(
from = as.Date(date_dis_pos),
by = "7 days",
length.out = 10
)
recheck_dates
date_bir <- "1961/3/1"
date_dis <- "2022å¹´1æœˆ1æ—¥"
date_dis <- gsub("[å¹´æœˆæ—¥]", "-", date_dis)
date_bir <- as.Date(date_bir)
date_dis <- as.POSIXct(date_dis)
date_bir
date_dis
format(date_bir, "%Y")
format(date_bir, "%m")
age <- ifelse(
format(date_dis_pos, "%m-%d") >= format(date_bir, "%m-%d"),
as.numeric(format(date_dis, "%Y")) - as.numeric(format(date_bir, "%Y")),
as.numeric(format(date_dis, "%Y")) - as.numeric(format(date_bir, "%Y")) - 1
)
age
sink("test.txt")
cat("å‘ç—…å¹´é¾„:", age, "å‘¨å²\n")
sink()
date_dis_monyy <- format(date_dis, "%b%y")
date_dis_monyy
recheck_dates <- seq(
from = as.Date(date_dis),
by = "7 days",
length.out = 10
)
recheck_dates
age <- ifelse(
format(date_dis, "%m-%d") >= format(date_bir, "%m-%d"),
as.numeric(format(date_dis, "%Y")) - as.numeric(format(date_bir, "%Y")),
as.numeric(format(date_dis, "%Y")) - as.numeric(format(date_bir, "%Y")) - 1
)
age
sink("test.txt")
cat("å‘ç—…å¹´é¾„:", age, "å‘¨å²\n")
sink()
knitr::opts_chunk$set(echo = TRUE)
x <- factor(c("ç”·", "å¥³", "ç”·", "å¥³"))
levels(x)[levels(x) == "ç”·"] <- "M"
levels(x)[levels(x) == "å¥³"] <- "F"
cat(as.character(x), file = "factor.txt")
# åˆ›å»ºæœ‰åºå› å­
y <- factor(c("å¤§ä¸€", "å¤§å››", "å¤§ä¸‰", "å¤§äºŒ"),
levels = c("å¤§ä¸€", "å¤§äºŒ", "å¤§ä¸‰", "å¤§å››"),
ordered = TRUE)
# æ’åºå¹¶è¾“å‡º
sorted_y <- sort(y)
print(sorted_y)
x <- c(100, 65, 80, 79, 88, 95, 93, 35, 56, 68)
# ä»å°åˆ°å¤§æ’åº
sorted_x <- sort(x)
cat("æ’åºåçš„å‘é‡:", sorted_x, "\n")
# æœ€å¤§å€¼
max_value <- max(x)
cat("æœ€å¤§å€¼:", max_value, "\n")
# æœ€å°å€¼
min_value <- min(x)
cat("æœ€å°å€¼:", min_value, "\n")
# ä¸­ä½æ•°
median_value <- median(x)
cat("ä¸­ä½æ•°:", median_value, "\n")
# ç¬¬ä¸‰å¤§çš„å…ƒç´ ï¼ˆå…ˆé™åºæ’åºåå–ç¬¬ä¸‰ä¸ªï¼‰
third_largest <- sort(x, decreasing = TRUE)[3]
cat("ç¬¬ä¸‰å¤§çš„å…ƒç´ :", third_largest, "\n")
odd_position_elements <- x[seq(1, length(x), by = 2)]
cat("å¥‡æ•°ä½ç½®çš„å…ƒç´ :", odd_position_elements, "\n")
even_values <- x[x %% 2 == 0]
cat("å¶æ•°å…ƒç´ :", even_values, "\n")
m <- diag(1:10, nrow = 10, ncol = 10)
print("åˆå§‹çŸ©é˜µ m:")
print(m)
x <- rep(1, 10)  # åˆ›å»ºé•¿åº¦ä¸º10çš„å…¨1å‘é‡
inv_m <- solve(m)  # è®¡ç®—é€†çŸ©é˜µ
y <- inv_m %*% x  # è§£æ–¹ç¨‹ mğ‘¦=ğ‘¥
print("è§£å‘é‡ y:")
print(y)
m[2, -2] <- 100  # -2 è¡¨ç¤ºæ’é™¤ç¬¬2åˆ—ï¼ˆå¯¹è§’çº¿ï¼‰
print("ä¿®æ”¹åçš„çŸ©é˜µ m:")
print(m)
element <- m[5, 9]
cat("æå–çš„å…ƒç´ å€¼:", element, "\n")
m[5, 9] <- NA  # èµ‹å€¼ä¸ºNA
print("ä¿®æ”¹åçš„çŸ©é˜µ m:")
print(m)
colnames(m) <- paste0("c", 1:10)
print("æ·»åŠ åˆ—ååçš„çŸ©é˜µ m:")
print(m)
m <- rbind(m, x)  # æ·»åŠ ç¬¬11è¡Œ
print("æ·»åŠ æ–°è¡Œåçš„çŸ©é˜µ m:")
print(m)
row_means <- rowMeans(m, na.rm = TRUE)
print("æŒ‰è¡Œè®¡ç®—çš„å¹³å‡å€¼:")
print(row_means)
arr <- array(
data = c(m, 2*m, 3*m),  # ä¾æ¬¡å¡«å…… m, 2m, 3m
dim = c(10, 10, 3)       # ç»´åº¦ä¸º10Ã—10Ã—3
)
print("ä¸‰ç»´æ•°ç»„ arr çš„ç»´åº¦:")
print(dim(arr))
age <- score.age
score <- list(name="ææ˜", id = "PB1", age=19, scores=c(85, 76, 90))
age <- score.age
score <- list(name="ææ˜", id = "PB1", age=19, scores=c(85, 76, 90))
current_year <- as.integer(format(Sys.Date(), "%Y"))
birth_year <- current_year - score$age
cat("å‡ºç”Ÿå¹´ä»½:", birth_year, "\n")
y <- score$scores
mean_score <- mean(y)
cat("å¹³å‡æˆç»©:", mean_score, "\n")
score$excellent <- mean_score > 85
print(score)
# è¯»å–æ•°æ®
pat1 <- read.csv("covid19.csv")
# åˆ é™¤æ€§åˆ«ç¼ºå¤±çš„è¡Œ
pat1 <- subset(pat1, !is.na(æ€§åˆ«))  # æˆ–ä½¿ç”¨ pat1 <- pat1[complete.cases(pat1$æ€§åˆ«), ]
# æŸ¥çœ‹å¤„ç†åçš„æ•°æ®
head(pat1)
# è¯»å–æ•°æ®
pat1 <- read.csv("covid19.csv")
# åˆ é™¤æ€§åˆ«ç¼ºå¤±çš„è¡Œ
pat1 <- pat1[complete.cases(pat1$æ€§åˆ«), ]
# æŸ¥çœ‹å¤„ç†åçš„æ•°æ®
head(pat1)
# è¯»å–æ•°æ®
pat1 <- read.csv("covid19.csv")
# åˆ é™¤æ€§åˆ«ç¼ºå¤±çš„è¡Œ
pat1 <- pat1[complete.cases(pat1$æ€§åˆ«), ]
# æŸ¥çœ‹å¤„ç†åçš„æ•°æ®
head(pat1)
# è¯»å–æ•°æ®
pat1 <- read.csv("covid19.csv")
# åˆ é™¤æ€§åˆ«ç¼ºå¤±çš„è¡Œ
pat1 <- pat1[complete.cases(pat1$æ€§åˆ«), ]
# æŸ¥çœ‹å¤„ç†åçš„æ•°æ®
pat1
# è¯»å–æ•°æ®
pat1 <- read.csv("covid19.csv")
# åˆ é™¤æ€§åˆ«ç¼ºå¤±çš„è¡Œ
pat1 <- pat1[pat1$å¹´é¾„ != '' ]
# è¯»å–æ•°æ®
pat1 <- read.csv("covid19.csv")
# åˆ é™¤æ€§åˆ«ç¼ºå¤±çš„è¡Œ
pat1 <- pat1[pat1$æ€§åˆ« != '' ]
# è¯»å–æ•°æ®
pat1 <- read.csv("covid19.csv")
# åˆ é™¤æ€§åˆ«ç¼ºå¤±çš„è¡Œ
pat1 <- pat1[!is.na(pat1$æ€§åˆ«), ]
# æŸ¥çœ‹å¤„ç†åçš„æ•°æ®
pat1
# è¯»å–æ•°æ®
pat1 <- read.csv("covid19.csv")
# åˆ é™¤ç©ºå­—ç¬¦ä¸²å’ŒNAå€¼
pat1 <- pat1[!(is.na(pat1$æ€§åˆ«) | pat1$æ€§åˆ« == ""), ]
# æŸ¥çœ‹å¤„ç†åçš„æ•°æ®
pat1
# è®¡ç®—ä½é™¢æ—¶é—´ï¼ˆå‡è®¾æ—¥æœŸåˆ—ä¸ºå­—ç¬¦ç±»å‹ï¼Œéœ€å…ˆè½¬æ¢ä¸ºæ—¥æœŸï¼‰
pat1$å…¥é™¢æ—¶é—´ <- as.Date(pat1$å…¥é™¢æ—¶é—´)
pat1$å‡ºé™¢æ—¶é—´ <- as.Date(pat1$å‡ºé™¢æ—¶é—´)
pat1$ä½é™¢æ—¶é—´ <- as.numeric(pat1$å‡ºé™¢æ—¶é—´ - pat1$å…¥é™¢æ—¶é—´) + 1
# æŒ‰åˆ†å‹è®¡ç®—ç»Ÿè®¡é‡
library(dplyr)
install.packages(dplyr)
# è®¡ç®—ä½é™¢æ—¶é—´ï¼ˆå‡è®¾æ—¥æœŸåˆ—ä¸ºå­—ç¬¦ç±»å‹ï¼Œéœ€å…ˆè½¬æ¢ä¸ºæ—¥æœŸï¼‰
pat1$å…¥é™¢æ—¶é—´ <- as.Date(pat1$å…¥é™¢æ—¶é—´)
pat1$å‡ºé™¢æ—¶é—´ <- as.Date(pat1$å‡ºé™¢æ—¶é—´)
pat1$ä½é™¢æ—¶é—´ <- as.numeric(pat1$å‡ºé™¢æ—¶é—´ - pat1$å…¥é™¢æ—¶é—´) + 1
# æŒ‰åˆ†å‹è®¡ç®—ç»Ÿè®¡é‡
library(dplyr)
install.packages('dplyr')
# è®¡ç®—ä½é™¢æ—¶é—´ï¼ˆå‡è®¾æ—¥æœŸåˆ—ä¸ºå­—ç¬¦ç±»å‹ï¼Œéœ€å…ˆè½¬æ¢ä¸ºæ—¥æœŸï¼‰
pat1$å…¥é™¢æ—¶é—´ <- as.Date(pat1$å…¥é™¢æ—¶é—´)
pat1$å‡ºé™¢æ—¶é—´ <- as.Date(pat1$å‡ºé™¢æ—¶é—´)
pat1$ä½é™¢æ—¶é—´ <- as.numeric(pat1$å‡ºé™¢æ—¶é—´ - pat1$å…¥é™¢æ—¶é—´) + 1
# æŒ‰åˆ†å‹è®¡ç®—ç»Ÿè®¡é‡
library(dplyr)
stats <- pat1 %>%
group_by(åˆ†å‹) %>%
summarise(
å¹³å‡ä½é™¢æ—¶é—´ = round(mean(ä½é™¢æ—¶é—´, na.rm = TRUE), 1),
æœ€é•¿ä½é™¢æ—¶é—´ = max(ä½é™¢æ—¶é—´, na.rm = TRUE),
æœ€çŸ­ä½é™¢æ—¶é—´ = min(ä½é™¢æ—¶é—´, na.rm = TRUE)
)
print(stats)
# è®¡ç®—ä½é™¢æ—¶é—´ï¼ˆå‡è®¾æ—¥æœŸåˆ—ä¸ºå­—ç¬¦ç±»å‹ï¼Œéœ€å…ˆè½¬æ¢ä¸ºæ—¥æœŸï¼‰
pat1$å…¥é™¢æ—¶é—´ <- as.Date(pat1$å…¥é™¢æ—¶é—´)
pat1$å‡ºé™¢æ—¶é—´ <- as.Date(pat1$å‡ºé™¢æ—¶é—´)
pat1$ä½é™¢æ—¶é—´ <- as.numeric(pat1$å‡ºé™¢æ—¶é—´ - pat1$å…¥é™¢æ—¶é—´) + 1
# æŒ‰åˆ†å‹è®¡ç®—ç»Ÿè®¡é‡
library(dplyr)
stats <- pat1 %>%
group_by(åˆ†å‹) %>%
summarise(
å¹³å‡ä½é™¢æ—¶é—´ = round(mean(ä½é™¢æ—¶é—´, na.rm = TRUE), 1),
æœ€é•¿ä½é™¢æ—¶é—´ = max(ä½é™¢æ—¶é—´, na.rm = TRUE),
æœ€çŸ­ä½é™¢æ—¶é—´ = min(ä½é™¢æ—¶é—´, na.rm = TRUE)
)
print(stats)
# è®¡ç®—ä½é™¢æ—¶é—´ï¼ˆå‡è®¾æ—¥æœŸåˆ—ä¸ºå­—ç¬¦ç±»å‹ï¼Œéœ€å…ˆè½¬æ¢ä¸ºæ—¥æœŸï¼‰
pat1$å…¥é™¢æ—¶é—´ <- as.Date(pat1$å…¥é™¢æ—¶é—´)
pat1$å‡ºé™¢æ—¶é—´ <- as.Date(pat1$å‡ºé™¢æ—¶é—´)
pat1$ä½é™¢æ—¶é—´ <- as.numeric(pat1$å‡ºé™¢æ—¶é—´ - pat1$å…¥é™¢æ—¶é—´) + 1
pat1
# æŒ‰åˆ†å‹è®¡ç®—ç»Ÿè®¡é‡
library(dplyr)
stats <- pat1 %>%
group_by(åˆ†å‹) %>%
summarise(
å¹³å‡ä½é™¢æ—¶é—´ = round(mean(ä½é™¢æ—¶é—´, na.rm = TRUE), 1),
æœ€é•¿ä½é™¢æ—¶é—´ = max(ä½é™¢æ—¶é—´, na.rm = TRUE),
æœ€çŸ­ä½é™¢æ—¶é—´ = min(ä½é™¢æ—¶é—´, na.rm = TRUE)
)
print(stats)
# è¯»å–æ•°æ®
pat1 <- read.csv("covid19.csv")
# åˆ é™¤ç©ºå­—ç¬¦ä¸²å’ŒNAå€¼
pat1 <- pat1[!(is.na(pat1$æ€§åˆ«) | pat1$æ€§åˆ« == ""), ]
pat1[51, "å…¥é™¢æ—¶é—´"] <- "20200205"
# æŸ¥çœ‹å¤„ç†åçš„æ•°æ®
pat1
# è®¡ç®—ä½é™¢æ—¶é—´ï¼ˆå‡è®¾æ—¥æœŸåˆ—ä¸ºå­—ç¬¦ç±»å‹ï¼Œéœ€å…ˆè½¬æ¢ä¸ºæ—¥æœŸï¼‰
pat1$å…¥é™¢æ—¶é—´ <- as.Date(pat1$å…¥é™¢æ—¶é—´)
# è¯»å–æ•°æ®
pat1 <- read.csv("covid19.csv")
# åˆ é™¤ç©ºå­—ç¬¦ä¸²å’ŒNAå€¼
pat1 <- pat1[!(is.na(pat1$æ€§åˆ«) | pat1$æ€§åˆ« == ""), ]
pat1[51, "å…¥é™¢æ—¶é—´"] <- 20200205
# æŸ¥çœ‹å¤„ç†åçš„æ•°æ®
pat1
# è®¡ç®—ä½é™¢æ—¶é—´ï¼ˆå‡è®¾æ—¥æœŸåˆ—ä¸ºå­—ç¬¦ç±»å‹ï¼Œéœ€å…ˆè½¬æ¢ä¸ºæ—¥æœŸï¼‰
pat1$å…¥é™¢æ—¶é—´ <- as.Date(pat1$å…¥é™¢æ—¶é—´)
pat1$å‡ºé™¢æ—¶é—´ <- as.Date(pat1$å‡ºé™¢æ—¶é—´)
pat1$ä½é™¢æ—¶é—´ <- as.numeric(pat1$å‡ºé™¢æ—¶é—´ - pat1$å…¥é™¢æ—¶é—´) + 1
# æŒ‰åˆ†å‹è®¡ç®—ç»Ÿè®¡é‡
library(dplyr)
stats <- pat1 %>%
group_by(åˆ†å‹) %>%
summarise(
å¹³å‡ä½é™¢æ—¶é—´ = round(mean(ä½é™¢æ—¶é—´, na.rm = TRUE), 1),
æœ€é•¿ä½é™¢æ—¶é—´ = max(ä½é™¢æ—¶é—´, na.rm = TRUE),
æœ€çŸ­ä½é™¢æ—¶é—´ = min(ä½é™¢æ—¶é—´, na.rm = TRUE)
)
print(stats)
# è¯»å–æ•°æ®
pat1 <- read.csv("covid19.csv")
# åˆ é™¤ç©ºå­—ç¬¦ä¸²å’ŒNAå€¼
pat1 <- pat1[!(is.na(pat1$æ€§åˆ«) | pat1$æ€§åˆ« == ""), ]
pat1[51, "å…¥é™¢æ—¶é—´"] <- 20200205
# æŸ¥çœ‹å¤„ç†åçš„æ•°æ®
pat1
# è®¡ç®—ä½é™¢æ—¶é—´ï¼ˆå‡è®¾æ—¥æœŸåˆ—ä¸ºå­—ç¬¦ç±»å‹ï¼Œéœ€å…ˆè½¬æ¢ä¸ºæ—¥æœŸï¼‰
pat1$å…¥é™¢æ—¶é—´ <- as.Date(pat1$å…¥é™¢æ—¶é—´)
pat1$å‡ºé™¢æ—¶é—´ <- as.Date(pat1$å‡ºé™¢æ—¶é—´)
pat1$ä½é™¢æ—¶é—´ <- as.numeric(pat1$å‡ºé™¢æ—¶é—´ - pat1$å…¥é™¢æ—¶é—´) + 1
# æŒ‰åˆ†å‹è®¡ç®—ç»Ÿè®¡é‡
library(dplyr)
stats <- pat1 %>%
group_by(åˆ†å‹) %>%
summarise(
å¹³å‡ä½é™¢æ—¶é—´ = round(mean(ä½é™¢æ—¶é—´, na.rm = TRUE), 1),
æœ€é•¿ä½é™¢æ—¶é—´ = max(ä½é™¢æ—¶é—´, na.rm = TRUE),
æœ€çŸ­ä½é™¢æ—¶é—´ = min(ä½é™¢æ—¶é—´, na.rm = TRUE)
)
print(stats)
# è¯»å–æ•°æ®
pat1 <- read.csv("covid19.csv")
# åˆ é™¤ç©ºå­—ç¬¦ä¸²å’ŒNAå€¼
pat1 <- pat1[!(is.na(pat1$æ€§åˆ«) | pat1$æ€§åˆ« == ""), ]
pat1[51, "å…¥é™¢æ—¶é—´"] <- as.Date("20200205", format = "%Y%m%d")
# æŸ¥çœ‹å¤„ç†åçš„æ•°æ®
pat1
# è¯»å–æ•°æ®
pat1 <- read.csv("covid19.csv")
# åˆ é™¤ç©ºå­—ç¬¦ä¸²å’ŒNAå€¼
pat1 <- pat1[!(is.na(pat1$æ€§åˆ«) | pat1$æ€§åˆ« == ""), ]
pat1[51, "å…¥é™¢æ—¶é—´"] <- as.Date("20200205", format = "%Y%m%d")
# æŸ¥çœ‹å¤„ç†åçš„æ•°æ®
pat1
# è¯»å–æ•°æ®
pat1 <- read.csv("covid19.csv")
# åˆ é™¤ç©ºå­—ç¬¦ä¸²å’ŒNAå€¼
pat1 <- pat1[!(is.na(pat1$æ€§åˆ«) | pat1$æ€§åˆ« == ""), ]
pat1[51, "å…¥é™¢æ—¶é—´"] <- as.Date("20200205", format = "%Y%m%d")
# æŸ¥çœ‹å¤„ç†åçš„æ•°æ®
pat1[51, ]
# è¯»å–æ•°æ®
pat1 <- read.csv("covid19.csv")
# åˆ é™¤ç©ºå­—ç¬¦ä¸²å’ŒNAå€¼
pat1 <- pat1[!(is.na(pat1$æ€§åˆ«) | pat1$æ€§åˆ« == ""), ]
pat1[51, "å…¥é™¢æ—¶é—´"] <- as.Date("20200205", format = "%Y%m%d")
# æŸ¥çœ‹å¤„ç†åçš„æ•°æ®
pat1[50, ]
# è¯»å–æ•°æ®
pat1 <- read.csv("covid19.csv")
# åˆ é™¤ç©ºå­—ç¬¦ä¸²å’ŒNAå€¼
pat1 <- pat1[!(is.na(pat1$æ€§åˆ«) | pat1$æ€§åˆ« == ""), ]
pat1[50, "å…¥é™¢æ—¶é—´"] <- as.Date("20200205", format = "%Y%m%d")
# æŸ¥çœ‹å¤„ç†åçš„æ•°æ®
pat1[50, ]
# è¯»å–æ•°æ®
pat1 <- read.csv("covid19.csv")
# åˆ é™¤ç©ºå­—ç¬¦ä¸²å’ŒNAå€¼
pat1 <- pat1[!(is.na(pat1$æ€§åˆ«) | pat1$æ€§åˆ« == ""), ]
pat1[50, "å…¥é™¢æ—¶é—´"] <- as.Date("20200205", format = "%Y%m%d")
# æŸ¥çœ‹å¤„ç†åçš„æ•°æ®
pat1[50, ]
# è¯»å–æ•°æ®
pat1 <- read.csv("covid19.csv")
# åˆ é™¤ç©ºå­—ç¬¦ä¸²å’ŒNAå€¼
pat1 <- pat1[!(is.na(pat1$æ€§åˆ«) | pat1$æ€§åˆ« == ""), ]
pat1[50, "å…¥é™¢æ—¶é—´"] <- 20200205
# æŸ¥çœ‹å¤„ç†åçš„æ•°æ®
pat1[50, ]
# è¯»å–æ•°æ®
pat1 <- read.csv("covid19.csv")
# åˆ é™¤ç©ºå­—ç¬¦ä¸²å’ŒNAå€¼
pat1 <- pat1[!(is.na(pat1$æ€§åˆ«) | pat1$æ€§åˆ« == ""), ]
pat1[50, "å…¥é™¢æ—¶é—´"] <- 20200205
# æŸ¥çœ‹å¤„ç†åçš„æ•°æ®
pat1
# è®¡ç®—ä½é™¢æ—¶é—´ï¼ˆå‡è®¾æ—¥æœŸåˆ—ä¸ºå­—ç¬¦ç±»å‹ï¼Œéœ€å…ˆè½¬æ¢ä¸ºæ—¥æœŸï¼‰
pat1$å…¥é™¢æ—¶é—´ <- as.Date(pat1$å…¥é™¢æ—¶é—´)
pat1$å‡ºé™¢æ—¶é—´ <- as.Date(pat1$å‡ºé™¢æ—¶é—´)
pat1$ä½é™¢æ—¶é—´ <- as.numeric(pat1$å‡ºé™¢æ—¶é—´ - pat1$å…¥é™¢æ—¶é—´) + 1
# æŒ‰åˆ†å‹è®¡ç®—ç»Ÿè®¡é‡
library(dplyr)
stats <- pat1 %>%
group_by(åˆ†å‹) %>%
summarise(
å¹³å‡ä½é™¢æ—¶é—´ = round(mean(ä½é™¢æ—¶é—´, na.rm = TRUE), 1),
æœ€é•¿ä½é™¢æ—¶é—´ = max(ä½é™¢æ—¶é—´, na.rm = TRUE),
æœ€çŸ­ä½é™¢æ—¶é—´ = min(ä½é™¢æ—¶é—´, na.rm = TRUE)
)
print(stats)
# å°†å¹´é¾„åˆ†æ®µ
pat1$å¹´é¾„æ®µ <- cut(
pat1$å¹´é¾„,
breaks = c(0, 18, 45, 60, 70, Inf),
labels = c("0-18", "19-45", "46-60", "61-70", "70ä»¥ä¸Š"),
right = FALSE  # å·¦é—­å³å¼€åŒºé—´ï¼Œä¾‹å¦‚ [0,18)
)
# æŸ¥çœ‹æ–°å¢çš„å¹´é¾„æ®µåˆ—
table(pat1$å¹´é¾„æ®µ)
# è®¡ç®—å‘ç—…äººæ•°å’Œç™¾åˆ†æ¯”
cross_tab <- pat1 %>%
group_by(å¹´é¾„æ®µ, æ€§åˆ«) %>%
summarise(äººæ•° = n(), .groups = "drop") %>%
mutate(ç™¾åˆ†æ¯” = round(äººæ•° / sum(äººæ•°) * 100, 1))
# è½¬æ¢ä¸ºå®½æ ¼å¼ï¼ˆæ¯è¡Œä¸€ä¸ªå¹´é¾„æ®µï¼‰
library(tidyr)
install.packages('tidyr')
# è®¡ç®—å‘ç—…äººæ•°å’Œç™¾åˆ†æ¯”
cross_tab <- pat1 %>%
group_by(å¹´é¾„æ®µ, æ€§åˆ«) %>%
summarise(äººæ•° = n(), .groups = "drop") %>%
mutate(ç™¾åˆ†æ¯” = round(äººæ•° / sum(äººæ•°) * 100, 1))
# è½¬æ¢ä¸ºå®½æ ¼å¼ï¼ˆæ¯è¡Œä¸€ä¸ªå¹´é¾„æ®µï¼‰
library(tidyr)
cross_tab_wide <- cross_tab %>%
pivot_wider(
names_from = æ€§åˆ«,
values_from = c(äººæ•°, ç™¾åˆ†æ¯”),
names_glue = "{æ€§åˆ«}_{.value}"
)
# ä¿å­˜ä¸ºCSV
write.csv(cross_tab_wide, "å¹´é¾„æ€§åˆ«åˆ†å¸ƒ.csv", row.names = FALSE)
# è®¡ç®—å‘ç—…äººæ•°å’Œç™¾åˆ†æ¯”
cross_tab <- pat1 %>%
group_by(å¹´é¾„æ®µ, æ€§åˆ«) %>%
summarise(äººæ•° = n(), .groups = "drop") %>%
mutate(ç™¾åˆ†æ¯” = round(äººæ•° / sum(äººæ•°) * 100, 1))
# è½¬æ¢ä¸ºå®½æ ¼å¼ï¼ˆæ¯è¡Œä¸€ä¸ªå¹´é¾„æ®µï¼‰
library(tidyr)
cross_tab_wide <- cross_tab %>%
pivot_wider(
names_from = æ€§åˆ«,
values_from = c(äººæ•°, ç™¾åˆ†æ¯”),
names_glue = "{æ€§åˆ«}_{.value}"
)
# ä¿å­˜ä¸ºCSV
write.csv(cross_tab_wide, "å¹´é¾„æ€§åˆ«åˆ†å¸ƒ.csv", row.names = FALSE)
# è¯»å–æ•°æ®
pat2 <- read.csv("covid19-3.csv")
# è¾“å‡ºåˆ—åå’Œå‰3è¡Œ
cat("åˆ—å:", colnames(pat2), "\n")
cat("å‰ä¸‰è¡Œå†…å®¹:\n")
print(head(pat2, 3))
# å‡è®¾åˆå¹¶ä¾æ®ä¸ºæ‚£è€…IDï¼ˆå‡è®¾åˆ—åä¸º"æ‚£è€…ID"ï¼‰
pat <- left_join(pat1, pat2, by = "æ‚£è€…ID")
# å‡è®¾åˆå¹¶ä¾æ®ä¸ºæ‚£è€…IDï¼ˆå‡è®¾åˆ—åä¸º"æ‚£è€…ID"ï¼‰
pat <- left_join(pat1, pat2, by = "åºå·")
# æŸ¥çœ‹åˆå¹¶åçš„æ•°æ®
dim(pat)
# å‡è®¾åˆå¹¶ä¾æ®ä¸ºæ‚£è€…IDï¼ˆå‡è®¾åˆ—åä¸º"æ‚£è€…ID"ï¼‰
pat <- left_join(pat1, pat2, by = "åºå·")
# æŸ¥çœ‹åˆå¹¶åçš„æ•°æ®
pat
# æ‰¾å‡ºç—…äººæœ€å¤šçš„ä¸‰ä¸ªèŒä¸š
top_occupations <- pat %>%
count(èŒä¸š, sort = TRUE) %>%
top_n(3)
cat("ç—…äººæœ€å¤šçš„ä¸‰ä¸ªèŒä¸š:\n")
print(top_occupations)
# ç»Ÿè®¡æ¯ä¸ªèŒä¸šçš„ä½é™¢æ—¶é—´å’Œå¹´é¾„
occupation_stats <- pat %>%
filter(èŒä¸š %in% top_occupations$èŒä¸š) %>%
group_by(èŒä¸š) %>%
summarise(
ä½é™¢æ—¶é—´_ä¸è¶…è¿‡10å¤© = sum(ä½é™¢æ—¶é—´ <= 10, na.rm = TRUE),
ä½é™¢æ—¶é—´_è¶…è¿‡10å¤© = sum(ä½é™¢æ—¶é—´ > 10, na.rm = TRUE),
å¹³å‡å¹´é¾„ = round(mean(å¹´é¾„, na.rm = TRUE), 1)
)
print(occupation_stats)
knitr::opts_chunk$set(echo = TRUE)
# å®šä¹‰åˆ†æ®µå‡½æ•°
myfun <- function(x, lambda) {
ifelse(x > lambda, x - lambda,
ifelse(x < -lambda, x + lambda, 0))
}
# ç”Ÿæˆæ•°æ®èŒƒå›´
x <- seq(-3, 3, length.out = 1000)
lambda <- 1  # å¯è°ƒæ•´ lambda çš„å€¼
# è®¡ç®—ä¸åŒ lambda å¯¹åº”çš„å‡½æ•°å€¼
y_lambda <- myfun(x, lambda)
y_lambda0 <- myfun(x, 0)
# ç»˜åˆ¶å›¾åƒ
plot(x, y_lambda, type = "l", col = "blue", lwd = 2,
xlab = "x", ylab = "f(x)",
main = expression(paste("Function f(x) with ", lambda, "=1 and ", lambda, "=0")))
lines(x, y_lambda0, col = "red", lty = 2, lwd = 2)
legend("topleft", legend = c(expression(lambda == 1), expression(lambda == 0)),
col = c("blue", "red"), lty = c(1, 2), lwd = 2)
knitr::opts_chunk$set(echo = TRUE)
coordinate_descent <- function(X, y, lambda, max_iter = 1000, tol = 1e-6) {
p <- ncol(X)
beta <- rep(0, p)  # åˆå§‹åŒ– beta ä¸ºå…¨é›¶
iter <- 0
converged <- FALSE
while (iter < max_iter && !converged) {
beta_old <- beta
# éå†æ¯ä¸ªç»´åº¦æ›´æ–°ç³»æ•°
for (j in 1:p) {
X_j <- X[, j]
# è®¡ç®—æ®‹å·®ï¼ˆç§»é™¤å½“å‰ç»´åº¦çš„è´¡çŒ®ï¼‰
r <- y - X %*% beta + X_j * beta[j]
# è®¡ç®—å±€éƒ¨æœ€ä¼˜è§£
a <- sum(X_j * r) / sum(X_j^2)
lambda_scaled <- lambda / sum(X_j^2)
beta[j] <- myfun(a, lambda_scaled)
}
# æ£€æŸ¥æ”¶æ•›æ¡ä»¶
if (sqrt(sum((beta - beta_old)^2)) < tol) converged <- TRUE
iter <- iter + 1
}
beta
}
set.seed(123)
beta_true <- c(1, 0, 0.5)
n <- 100
library(MASS)
# ç”Ÿæˆåæ–¹å·®çŸ©é˜µ
Sigma <- matrix(0.5, nrow = 3, ncol = 3)
diag(Sigma) <- 1
# ç”Ÿæˆæ•°æ®
X <- mvrnorm(n, mu = c(0, 0, 0), Sigma = Sigma)
y <- X %*% beta_true + rnorm(n, 0, 0.5)
# è¿è¡Œç®—æ³•ï¼ˆlambda=0 æ—¶åº”æ¥è¿‘ OLS è§£ï¼‰
beta_hat <- coordinate_descent(X, y, lambda = 0.1)
print(beta_hat)  # é¢„æœŸè¾“å‡ºæ¥è¿‘ [1.0, 0.0, 0.5]
library(ggplot2)
install.packages('ggplot2')
install.packages('ggplot')
install.packages('ggplot2')
library(ggplot2)
# ç”Ÿæˆ lambda åºåˆ—
lambda_seq <- exp(seq(log(0.01), log(10), length.out = 50))
# è®¡ç®—ä¸åŒ lambda ä¸‹çš„ç³»æ•°ä¼°è®¡
beta_path <- t(sapply(lambda_seq, function(lam) coordinate_descent(X, y, lam)))
# è½¬æ¢ä¸ºé•¿æ ¼å¼æ•°æ®
library(tidyr)
df <- data.frame(lambda = lambda_seq, beta1 = beta_path[,1],
beta2 = beta_path[,2], beta3 = beta_path[,3])
df_long <- pivot_longer(df, cols = -lambda, names_to = "coefficient")
# ç»˜åˆ¶è·¯å¾„å›¾
ggplot(df_long, aes(x = lambda, y = value, color = coefficient)) +
geom_line(linewidth = 1) +
scale_x_log10() +  # xè½´å–å¯¹æ•°åˆ»åº¦
labs(x = "lambda (log scale)", y = "Coefficient Estimate",
title = "Lasso Solution Path") +
theme_minimal()
shiny::runApp('Desktop/å®ç”¨ç»Ÿè®¡è½¯ä»¶/EXP4/Buffon_experiment')
runApp('Desktop/å®ç”¨ç»Ÿè®¡è½¯ä»¶/EXP4/Buffon_experiment')
